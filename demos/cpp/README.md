# C++ Demos

- [Overview](#overview)
- [Building and Running the Demos on Linux and macOS](#building-and-running-the-demos-on-linux-and-macos)
- [Building and Running the Demos on Windows](#building-and-running-the-demos-on-windows)

## Overview

This directory contains C++ sample programs for DataStorm. These examples are
provided to get you started on using a particular DataStorm feature or coding
technique.

## Building and Running the Demos on Linux and macOS

### Prerequisites

The makefiles require GNU make 3.80 or later.

On macOS, the command-line demos require the Xcode Command Line Tools to be
installed (use `xcode-select --install` to install them).

If you've installed DataStorm in a non-standard location or want to use the
source tree build, you'll need to set the `DATASTORM_HOME` environment variable
with the path name of the installation directory or source tree:
```
export DATASTORM_HOME=~/testing/datastorm
```

### Building the Demos

Review the settings in `make/Make.rules`. For example, set `OPTIMIZE=yes`
to build with optimization.

When you're ready to start the build, run `make`, for example:
```
make V=1
```

`V=1` in the example above turns on verbose output.

The `clean` and `distclean` targets allow you clean all the demos. `clean`
removes the binary files created by the build; `distclean` removes all these
files plus the C++ files generated by slice2cpp.

Note that `make clean` only removes the binary files for the configuration and
platform specified with the `CONFIGS` and `PLATFORMS` variables in `Make.rules`.

You can also build or clean a single demo with `make <demo-path>[_clean|_distclean]`,
for example:
```
make V=1 stock
make stock_distclean
```

### Running the Demos

Refer to the README.md file in each demo directory for usage instructions.

## Building and Running the Demos on Windows

### Building the Demos

#### Building the demos using NuGet packages:

Open the solution file `DataStorm C++ demos.sln` to build the sample programs.

The demos are configured to use DataStorm C++ binary distribution, packaged with
NuGet. The build downloads automatically the DataStorm NuGet package.

If you have disabled the automatic download of NuGet packages by Visual Studio,
you need to restore the packages before you build using `Tools > NuGet Package
Manager > Manage NuGet Packages for Solution...` in Visual Studio.

Then select your target configuration (Debug or Release) and platform (Win32
or x64). Right click on the desired demo in the Solution Explorer window and
select `Build`.

#### Building the demos with DataStorm source distribution:

- Build from command line:
  * Open a Visual Studio command prompt
  ```
  cd datastorm\demos\cpp
  MSBuild /p:DataStormHome=<DataStorm dist path> /p:Configuration=<Release or Debug> msbuild\datastorm.proj"
  ```

- Build from Visual Studio
  * Open a Visual Studio command prompt
  ```
  cd datastorm\demos\cpp
  MSBuild /p:IceHome=<DataStorm dist path> /p:Configuration=<Release or Debug> /t:InstallLocalPackages msbuild\datastorm.proj"
  ```

  * Start Visual Studio and open `DataStorm C++ demos.sln` solution file, select
    your target configuration (Debug or Release) and platform (Win32 or x64).
    Right click on the desired demo in the Solution Explorer window and select
    `Build`.

### Running the Demos

You need to add the DataStorm `bin` directory to your PATH before running the
demos.

If you are building Debug, add the Debug `bin` directory with a command similar
to:
```
set PATH=%USERPROFILE%\datastorm\demos\cpp\packages\zeroc.datastorm.v140.0.1.0\build\native\bin\x64\Debug;%PATH%
```

If you are building Release, add the Release `bin` directory with a command
similar to:
```
set PATH=%USERPROFILE%\datastorm\demos\cpp\packages\zeroc.datastorm.v140.0.1.0\build\native\bin\x64\Release;%PATH%
```

Then refer to the README.md file in each demo directory for usage instructions.
